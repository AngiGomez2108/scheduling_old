{% extends "_base.html" %}
{% load static %}
{% load crispy_forms_tags %}


{% block title %}Gestionar Personas{% endblock title %}
{% block content %}
<style>
  
</style>
<div class=" card w-70 shadow-lg  rounded">
    <div class="card-header">
        <div class="title-list">
            <i class="fa-solid fa-users"></i> Gestionar Funcionarios 
        </div>
    </div>
    <div class="card-body" >
      <p class="card-text">
       
        <table class="table table-hover ">
            <thead>
                <tr>
                  <th scope="col-1">Identificación</th>
                  <th scope="col-3">Nombres</th>
                  <th scope="col-3">Apellidos</th>
                  <th scope="col-3">Correo Electrónico</th>
                  <th scope="col-2">Celular</th>
                  <th class="text-center"><i class="fa-solid fa-gears"></i></th>
                </tr>
              </thead>
              <tbody>
                {% for functionary in object_list %}
                <tr>
                    <td>{{ functionary.identification }}</td>
                    <td>{{ functionary.name }}</td>
                    <td>{{ functionary.lastname }}</td>
                    <td>{{ functionary.email }}</td> 
                    <td>{{ functionary.cellphone }}</td> 
                    
                    <td>
                        <a title="Ver" style="cursor: pointer;" href="../detail/{{ functionary.id }}" > <i
                            class="fa-solid fa-eye" style="color: #2980B9;"></i></a>
                        &nbsp;&nbsp;
                        <a title="Editar" style="cursor: pointer;" href="../update/{{ functionary.id }}"  ><i
                            class="fa-solid fa-pen" style="color: #F1C40F;"></i></a>
                        &nbsp;&nbsp;
                        <a title="Eliminar" style="cursor: pointer;" onclick="deleteFunctionary({{ functionary.id }})"><i
                            class="fa-solid fa-trash-can" style="color:  #E74C3C;"></i></a>
                    </td>
            {% empty %}
                <td colspan="2">No existen funcionarios registrados</td>
            {% endfor %}
        </tr>
                
              </tbody>
          </table>

          <div class="d-flex justify-content-end col-12 mt-3">
            <a href="{% url 'functionary-create' %}" class="btn btn-success"> <i class="fa-solid fa-plus"></i> Crear Nuevo</a>
        </div>
         
      </p>
    </div>
  </div>
  <script>
    function deleteFunctionary(id) {
         Swal.fire({
             title: 'Eliminar Funcionario',
             text: '¿Seguro  quiere eliminar el funcionario?',
             icon: 'warning',
             showCancelButton: true,
             confirmButtonText: 'Sí, eliminar funcionario',
             cancelButtonText: 'Cancelar',
         }).then((result) => {
             if (result.isConfirmed) {
                 var url = '/appointment/functionary/delete/' + id; 
                 fetch(url, {
                     method: 'DELETE',
                     headers: {
                         'Content-Type': 'application/json; charset=UTF-8'
                     },
                     headers: {
                         'X-CSRFToken': getCookie('csrftoken')
                     },
                 })
                     .then(response => {
                         console.log("response", response)
                         result = response.json()
                         status_code = response.status;
                         if (status_code != 200) {
                             console.log('Error in getting brand info!')
                             return false;
                         }
                         return result
                     })
                     .then(result => {
                         console.log("response", result);
                         if (result.success) {
                             Swal.fire({
                                 title: 'Operación exitosa',
                                 text: result.success,
                                 icon: 'success',
                                 timer: 1500,
                                 showConfirmButton: false,
                             }).then(() => {
                                 location.reload();
                             });
                         } else {
                             Swal.fire({
                                 title: 'Error',
                                 text: result.error,
                                 icon: 'error',
                             });
                         }
 
                         setTimeout(() => {
                             // var redirectUrl = "{% url 'citation-cancel-form' %}";
                             // window.location.href = redirectUrl; 
                         }, 500);
                     })
                     .catch(error => {
                         console.log(error)
                         setTimeout(() => {
                             var redirectUrl = "{% url 'functionary-list' %}";
                             window.location.href = redirectUrl;
                         }, 500);
                     });
             }
         });
 
 
     }
 
     function getCookie(name) {
         // Divide la cadena de cookies en partes
         var cookieArray = document.cookie.split(';');
 
         // Itera sobre las partes para buscar la cookie deseada
         for (var i = 0; i < cookieArray.length; i++) {
             var cookie = cookieArray[i].trim();
             // Comprueba si la cookie comienza con el nombre deseado
             if (cookie.indexOf(name + '=') === 0) {
                 // Devuelve el valor de la cookie
                 return cookie.substring(name.length + 1);
             }
         }
         // Si la cookie no se encuentra, devuelve null
         return null;
     }
 
 </script>

 <style>
    .card {
        box-shadow: 0 2px 4px rgba(0, 0, 20, .08), 0 1px 2px rgba(0, 0, 20, .08);
        border: 0;
        border-radius: 0.5rem;
    }

    .card-body {
        padding: 0 1rem;
        background-color: #fafafa;

    }

    .card .card-header {
        background-color: #ebeeee !important;

    }

    .title-list {
        font-weight: bolder;
        text-transform: capitalize;
        color: #637381;
    }

    .table thead th {
        padding: 0.75rem 1.5rem;
        text-transform: capitalize;
        color: #637381;
    }

    .table .tbody {
        font-size: 15px;
    }

    .table>:not(caption)>*>* {
        background-color: var(--bs-table-bg);
        border-bottom-width: 1px;
        box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
    }

    tbody,
    td,
    tfoot,
    th,
    thead,
    tr {
        border: 0 solid;
        border-color: inherit;
    }
</style>
{% endblock content %}


